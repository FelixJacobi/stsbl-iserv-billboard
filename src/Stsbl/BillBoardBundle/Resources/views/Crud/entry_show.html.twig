{# src/Stsbl/BillBoardBundle/Resources/views/Crud/entry_show.thtml.twig #}
{% extends 'IServCrudBundle:Crud:show.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    
    {% if app.environment != 'prod' %}
        <!-- {{ _self }} => billboard.css -->
    {% endif %}
    {% stylesheets output='css/compiled/billboard.css' '@StsblBillBoardBundle/Resources/public/css/billboard.less' filter='cssrewrite' %}
        <link rel="stylesheet" href="{{ asset_url }}" />
    {% endstylesheets %}
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    
    {% if app.environment != 'prod' %}
        <!-- {{ _self }} => mail.compose.js -->
    {% endif %}
    <script type="text/javascript" src="{{ asset('components/tinymce-dist/tinymce.js') }}"></script>
    <script type="text/javascript" src="{{ asset('components/tinymce-dist/jquery.tinymce.min.js') }}"></script>
    {% if app.request.locale == 'de_DE' %}
        <script type="text/javascript" src="{{ asset('components/tinymce-i10n/langs/de.js') }}"></script>
    {% endif %}
    {% javascripts output='js/compiled/mail.compose.js' filter='?uglifyjs2'
    '@IServMailBundle/Resources/public/js/pages/compose.js' %}
    <script type="text/javascript" src="{{ asset_url }}"></script>
    {% endjavascripts %}
{% endblock %}

{% block content %}
    <h1>{{ item.title }}</h1>
    {% block crud_form_actions %}
        {{ parent() }}
    {% endblock %}
    
    {% block crud_show %}
        <div class="panel panel-default">
            <div class="panel-body">
                <p class="text-secondary">
                    <span title="{{ _('Created') }}">{{ icon('calendar') }} {{ item.time|ldate }}</span> | 
                    <span title="{{ _('Last refresh') }}">{{ icon('refresh') }} {{ item.updatedAt|ldate }}</span> | 
                    <span title="{{ _('Author') }}">
                        {{ icon('user') }}
                        {% if not authorIsDeleted %}
                            <a class="mailto" title="{{ _('Send an e-mail to the author') }}"
                            href="mailto:{{ item.author.name ~ ' <' ~ item.author.username ~ '@' ~ servername ~ '>?subject=' ~ __('Entry "%s" on the billboard', item.title)|url_encode() }}">
                                {{ item.author }}
                            </a>
                        {% else %}
                            {{ item.author }}
                        {% endif %}
                    </span> | 
                    <span title="{{ _('Category') }}">{{ icon('tag') }} {{ item.category }}</span> | 
                    <span title="{{ _('Visibility') }}">
                        {% if item.visible %}
                            {{ icon('eye-open') }} {{ _('Visible') }}
                        {% else %}
                            {{ icon('eye-close') }} {{ _('Hidden') }}
                        {% endif %}
                    </span>
                    {% if item.closed %}
                        | <span title="{{ _('This entry is closed for any write access.') }}">{{ icon('lock') }} {{ _('Closed') }}</span>
                    {% endif %}
                </p>

                <p>
                    {{ item.description|raw }}
                </p>
            </div>
        </div>
    {% endblock crud_show %}
    {% block entry_images %}
        {% if item.images|length > 0 or isAuthor %}
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">{{ _('Images') }}</h3>
                </div>
                <div class="panel-body">
                    {% set thumbsize = thumbsize|default(80) %}
                    {% set images = item.images %}
                    {% if images is iterable %}
                        {% for ent in images %}
                            {% spaceless %}
                                <div class="billboard-image-container">
                                {% set imageRoute = admin.getRoute('fileimage_images')|default('fileimage') %}
                                <a data-toggle="modal-image" href="{{ path(imageRoute, {'id': ent.id, 'entity_id': item.id}) }}">
                                    <img src="{{ path(imageRoute, {'id': ent.id, 'entity_id': item.id, 'width': thumbsize, 'height': thumbsize}) }}"
                                    alt="{{ ent }}" class="img-thumbnail" width="{{ thumbsize }}" height="{{ thumbsize }}"/>
                                </a>
                                <br />
                                <span class="text-muted text-secondary"><strong>{{ _('Description')}}:</strong><br />{{ ent.description }}</span>
                                </div>
                            {% endspaceless %}
                        {% endfor %}
                    {% else %}
                        {% if images is null %}
                            -
                        {% else %}
                            {{ images }}
                        {% endif %}
                    {% endif %}
                </div>
                <div class="panel-footer">
                    {% if isAuthor %}
                        <div style="clear: both"></div>
                        <a href="#billboard-add-image" id="billboard-add-image" data-id="billboard-add-image" data-toggle="modal" data-target="#image-upload-container" class="btn-default btn">{{ icon('plus') }}{{ _('Add image') }}</a>
                    {% endif %}
                </div>    
            </div>
        {% endif %}
    {% endblock %}
    
    {% block entry_comments %}
        <h2>{{ _p('billboard', 'Comments') }}</h2>
        {% if item.comments is empty %}
            <div class="alert alert-info">{{ _('Currently no comments.') }}</div>
        {% else %}
            {% for comment in item.comments %}
                <div id="billboard-comment-{{ comment.id }}" class="panel panel-default">
                    <div class="panel-heading">
                        <strong>{{ comment.title }}</strong> {{ ' ' ~ _("by") ~ ' ' }} {{ icon('user') }}  {{ __("%s at %s", comment.authorDisplay, comment.time|ldatetime) }} <br />
                    </div>
                    <div class="panel-body">
                        {{ comment.content }}
                    </div>
                    {% if admin.isModerator(app.user) %}
                        <div class="panel-footer">
                            <a class="btn btn-default" href="{{ path('billboard_comment_delete_confirm', {'id': comment.id}) }}">{{ icon('remove-circle') }}{{ _('Delete') }}</a>
                        </div>
                    {% endif %}
                </div>
            {% endfor %}
        {% endif %}
    {% endblock %} 
    {% block entry_add_comment %}
        {% if admin.isAllowedToAdd(app.user) %}
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">{{ _('Add a comment') }}</h3>
                </div>
                <div class="panel-body">
                    {% if not admin.isModerator(app.user) and item.closed %}
                        <div class="alert alert-warning">{{ _('This entry is locked, therefor the creation of comments is not longer possible.') }}</div>
                    {% elseif commentsEnabled and admin.isAllowedToAdd(app.user) %}
                        {{ form(commentForm, {'style': null}) }}
                    {% else %}
                        <div class="alert alert-warning"> {{ _('The adding of new comments was disabled by your administrator.') }} </div>
                    {% endif %}
                </div>
            </div>
        {% endif %}
    {% endblock  %}
    {% block entry_modal_image_upload %}
    {% if isAuthor %}
    <div id="image-upload-container" class="modal" role="dialog">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">{{ _('Add a new image to this post') }}</h4>
                </div>
                <div class="modal-body">
                    <p>{{ _("Upload a new image.") }}</p>
                    {# {{ form(jobUploadForm, { 'style': 'inline', 'attr': {'id': 'file-upload'}}) }} #}
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">{{ icon('remove') }} {{ _('Close') }}</button>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
    {% endblock %}
{% endblock %}