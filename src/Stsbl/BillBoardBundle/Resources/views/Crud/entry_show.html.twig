{# src/Stsbl/BillBoardBundle/Resources/views/Crud/entry_show.thtml.twig #}
{% extends 'IServCrudBundle:Crud:show.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    
    {% if app.environment != 'prod' %}
        <!-- {{ _self.templateName }} => billboard.css -->
    {% endif %}
    {% stylesheets output='css/compiled/billboard.css' '@StsblBillBoardBundle/Resources/public/css/billboard.less' filter='cssrewrite' %}
        <link rel="stylesheet" href="{{ asset_url }}" />
    {% endstylesheets %}
{% endblock %}

{% block content %}
    <h1>{{ item.title }}</h1>
    {% block crud_form_actions %}
        {{ parent() }}
    {% endblock %}
    
    {% block crud_show %}
        <div class="panel panel-default">
            <div class="panel-body">
                <p class="text-secondary">
                    <span title="{{ _('Created') }}">{{ icon('calendar') }} {{ item.time|ldate }}</span> | 
                    <span title="{{ _('Last refresh') }}">{{ icon('refresh') }} {{ item.updatedAt|ldate }}</span> | 
                    <span title="{{ _('Author') }}">{{ icon('user') }} {{ item.author }}</span> | 
                    <span title="{{ _('Category') }}">{{ icon('tag') }} {{ item.category }}</span> | 
                    <span title="{{ _('Visibility') }}">
                        {% if item.visible %}
                            {{ icon('eye-open') }} {{ _('Visible') }}
                        {% else %}
                            {{ icon('eye-close') }} {{ _('Hidden') }}
                        {% endif %}
                    </span>
                </p>

                <p>
                    {{ item.description|raw }}
                </p>
            </div>
        </div>
    {% endblock crud_show %}
    {% block entry_images %}
        {% if item.images|length > 0 %}
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">{{ _('Images') }}</h3>
                </div>
                <div class="panel-body">
                    {% set thumbsize = thumbsize|default(80) %}
                    {% set images = item.images %}
                    {% if images is iterable %}
                        {% for ent in images %}
                            {% spaceless %}
                                <div class="billboard-image-container">
                                {% set imageRoute = admin.getRoute('fileimage_images')|default('fileimage') %}
                                <a data-toggle="modal-image" href="{{ path(imageRoute, {'id': ent.id, 'entity_id': item.id}) }}">
                                    <img src="{{ path(imageRoute, {'id': ent.id, 'entity_id': item.id, 'width': thumbsize, 'height': thumbsize}) }}"
                                    alt="{{ ent }}" class="img-thumbnail" width="{{ thumbsize }}" height="{{ thumbsize }}"/>
                                </a>
                                <br />
                                <span class="text-muted text-secondary"><strong>{{ _('Description')}}:</strong><br />{{ ent.description }}</span>
                                </div>
                            {% endspaceless %}
                        {% endfor %}
                    {% else %}
                        {% if images is null %}
                            -
                        {% else %}
                            {{ images }}
                        {% endif %}
                    {% endif %}
                </div>
            </div>
        {% endif %}
    {% endblock %}
    
    {% block entry_comments %}
        <h2>{{ _p('billboard', 'Comments') }}</h2>
        {% if item.comments is empty %}
            <div class="alert alert-info">{{ _('Currently no comments.') }}</div>
        {% else %}
            {% for comment in item.comments %}
                <div id="billboard-comment-{{ comment.id }}" class="panel panel-default">
                    <div class="panel-heading">
                        <strong>{{ comment.title }}</strong> {{ ' ' ~ _("by") ~ ' ' }} {{ icon('user') }}  {{ __("%s at %s", comment.authorDisplay, comment.time|ldatetime) }} <br />
                    </div>
                    <div class="panel-body">
                        {{ comment.content }}
                    </div>
                    {% if is_granted('PRIV_BILLBOARD_MODERATE') or is_granted('PRIV_BILLBOARD_MANAGE') %}
                        <div class="panel-footer">
                            <a class="btn btn-default" href="{{ path('billboard_comment_delete_confirm', {'id': comment.id}) }}">{{ icon('remove-circle') }}{{ _('Delete') }}</a>
                        </div>
                    {% endif %}
                </div>
            {% endfor %}
        {% endif %}
    {% endblock %} 
    {% block entry_add_comment %}
        {% if is_granted('PRIV_BILLBOARD_CREATE') or is_granted('PRIV_BILLBOARD_MODERATE') or is_granted('PRIV_BILLBOARD_MANAGE') %}
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">{{ _('Add a comment') }}</h3>
                </div>
                <div class="panel-body">
                    {% if comments_enabled %}
                        {{ form(comment_form, {'style': null}) }}
                    {% else %}
                        <div class="alert alert-warning"> {{ _('The adding of new comments was disabled by your administrator.') }} </div>
                    {% endif %}
                </div>
            </div>
        {% endif %}
    {% endblock  %}
{% endblock %}